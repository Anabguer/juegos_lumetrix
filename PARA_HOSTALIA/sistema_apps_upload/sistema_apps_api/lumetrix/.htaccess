# ========================================
# LUMETRIX - Configuración Apache/Hostalia
# ========================================

# Deshabilitar listado de directorios
Options -Indexes

# Seguir enlaces simbólicos (requerido por algunos hosts)
Options +FollowSymLinks

# ========================================
# SEGURIDAD
# ========================================

# Proteger archivos sensibles
<FilesMatch "\.(log|sql|md|example|env|ini|bak|backup)$">
  Require all denied
</FilesMatch>

# Proteger archivos PHP de configuración
<FilesMatch "^(config_|_common\.php)">
  Require all denied
</FilesMatch>

# Prevenir acceso a archivos ocultos
<FilesMatch "^\.">
  Require all denied
</FilesMatch>

# ========================================
# HEADERS DE SEGURIDAD
# ========================================

<IfModule mod_headers.c>
  # Prevenir MIME sniffing
  Header set X-Content-Type-Options "nosniff"
  
  # Protección contra clickjacking
  Header set X-Frame-Options "SAMEORIGIN"
  
  # XSS Protection (legacy pero aún útil)
  Header set X-XSS-Protection "1; mode=block"
  
  # Referrer Policy
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  
  # No enviar versión de PHP
  Header unset X-Powered-By
</IfModule>

# ========================================
# COMPRESIÓN GZIP
# ========================================

<IfModule mod_deflate.c>
  # Comprimir texto, HTML, CSS, JavaScript, JSON
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/plain
  
  # No comprimir imágenes (ya están comprimidas)
  SetEnvIfNoCase Request_URI \.(?:gif|jpe?g|png|webp)$ no-gzip dont-vary
  
  # No comprimir audio
  SetEnvIfNoCase Request_URI \.(?:mp3|wav|ogg)$ no-gzip dont-vary
</IfModule>

# ========================================
# CACHE DE NAVEGADOR
# ========================================

<IfModule mod_expires.c>
  ExpiresActive On
  
  # Imágenes - 1 mes
  ExpiresByType image/png "access plus 1 month"
  ExpiresByType image/jpg "access plus 1 month"
  ExpiresByType image/jpeg "access plus 1 month"
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType image/webp "access plus 1 month"
  
  # Audio - 1 mes
  ExpiresByType audio/mpeg "access plus 1 month"
  ExpiresByType audio/wav "access plus 1 month"
  ExpiresByType audio/ogg "access plus 1 month"
  
  # JavaScript y CSS - 1 semana (pueden cambiar con actualizaciones)
  ExpiresByType application/javascript "access plus 1 week"
  ExpiresByType text/javascript "access plus 1 week"
  ExpiresByType text/css "access plus 1 week"
  
  # HTML - sin cache (para ver cambios inmediatos)
  ExpiresByType text/html "access plus 0 seconds"
  
  # JSON - sin cache
  ExpiresByType application/json "access plus 0 seconds"
  
  # Source maps - sin cache (solo para debugging)
  ExpiresByType application/json "access plus 0 seconds"
</IfModule>

# ========================================
# TIPOS MIME
# ========================================

<IfModule mod_mime.c>
  # JavaScript
  AddType application/javascript .js
  AddType application/javascript .mjs
  
  # CSS
  AddType text/css .css
  
  # JSON
  AddType application/json .json
  AddType application/json .map
  
  # Fuentes
  AddType font/woff2 .woff2
  AddType font/woff .woff
  AddType font/ttf .ttf
  AddType font/otf .otf
  
  # Audio
  AddType audio/mpeg .mp3
  AddType audio/wav .wav
  AddType audio/ogg .ogg
  
  # Imágenes
  AddType image/webp .webp
  AddType image/svg+xml .svg
</IfModule>

# ========================================
# CORS (si es necesario)
# ========================================

# DESCOMENTADO SOLO SI HAY PROBLEMAS DE CORS
# <IfModule mod_headers.c>
#   # Permitir CORS solo desde el mismo dominio
#   SetEnvIf Origin "^https?://(.*\.)?tu-dominio\.com$" AccessControlAllowOrigin=$0
#   Header set Access-Control-Allow-Origin %{AccessControlAllowOrigin}e env=AccessControlAllowOrigin
#   Header set Access-Control-Allow-Credentials "true"
# </IfModule>

# ========================================
# REWRITE RULES (NO NECESARIAS)
# ========================================

# NO ACTIVAR - Este proyecto NO es SPA con routing client-side
# El HTML principal está fuera de esta carpeta (app_lumetrix.html)
# Esta carpeta solo contiene assets y API PHP

# Si necesitas rewrite para API limpia:
# RewriteEngine On
# RewriteCond %{REQUEST_FILENAME} !-f
# RewriteCond %{REQUEST_FILENAME} !-d
# RewriteRule ^api/(.+)$ $1.php [L,QSA]

# ========================================
# PHP SETTINGS
# ========================================

<IfModule mod_php.c>
  # Ocultar errores PHP en producción
  php_flag display_errors off
  php_flag log_errors on
  
  # Tiempo de sesión extendido (7 días)
  php_value session.gc_maxlifetime 604800
  
  # Tamaño máximo de upload (si hay uploads de avatar futuro)
  php_value upload_max_filesize 5M
  php_value post_max_size 8M
</IfModule>

# ========================================
# PROTECCIÓN CONTRA HOTLINKING
# ========================================

# Prevenir que otros sitios enlacen tus imágenes/audio directamente
<IfModule mod_rewrite.c>
  RewriteEngine On
  
  # Permitir acceso directo (sin referrer) para testing
  RewriteCond %{HTTP_REFERER} !^$
  
  # Permitir solo desde tu dominio (CAMBIAR tu-dominio.com)
  RewriteCond %{HTTP_REFERER} !^https?://(www\.)?tu-dominio\.com [NC]
  
  # Bloquear imágenes y audio
  RewriteRule \.(jpg|jpeg|png|gif|webp|mp3|wav)$ - [F,L]
</IfModule>

# ========================================
# CONFIGURACIÓN DE CHARSET
# ========================================

AddDefaultCharset UTF-8

# ========================================
# FIN
# ========================================

